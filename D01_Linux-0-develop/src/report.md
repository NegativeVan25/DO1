## Операционные системы UNIX/Linux (Базовый).

## Part 1. Установка ОС.
* Устанавливаем [Ubuntu-20.04-Server-LTS](https://old-releases.ubuntu.com/releases/20.04.0/ubuntu-20.04-live-server-amd64.iso) , [инструкция](https://linuxconfig.org/how-to-install-ubuntu-20-04-on-virtualbox) в VirtualBox и проверяем установленную версию командой:

  `cat /etc/issue` ;

![img_id_1](img_mediumcl/1.png)


## Part 2. Создание пользователя.

* 1. Cоздаем пользователя командой: 

 `sudo adduser (username)` ;        


![img_id_2](img_mediumcl/2.1.png)
 
 [Более подробная информация по утилите adduser](https://www.opennet.ru/man.shtml?topic=adduser&category=8&russian=0)
* 2. Добавляем права для пользователя с помощью команды: 

  `sudo useradd -G adm -p (password) -s /bin/bash (username)` ;

![img_id_3](img_mediumcl/2.2.png)

[Более подробная информация по утилите useradd](https://www.opennet.ru/man.shtml?topic=useradd&category=8&russian=0).

* 3. Проверяем правильность выполненных действий командой:

  `cat /etc/passwd` ;

![img_id_4](img_mediumcl/2.3.png)


## Part 3. Настройка сети ОС.

* 1. Задаём название машины:

  `sudo hostnamectl set-hostname user-1` ;

* 2. Задаем время, нам нужно Московское:

  `tzselect` ;

![img_id_5](img_mediumcl/3.1.png)

* Выбираем Европу, затем Россию, затем Москву:

![img_id_6](img_mediumcl/3.2.png)
![img_id_7](img_mediumcl/3.3.png)
 
* Подтверждаем:

![img_id_8](img_mediumcl/3.4.png)

* Способ 2:

  `sudo timedatectl set-timezone Europe/Moscow 
  sudo date`

![img_id_9](img_mediumcl/3.5.png)
* 3. Выясняем внешний **ip-адрес** , **ip-адрес** устройства , внутренний **ip-адрес** шлюза(**gw**) , а также выводим названия сетевых интерфейсов.
* Адрес устройства:

  ` hostname -I ` ;
     
![img_id_10](img_mediumcl/3.6.png)    
* Внешний адрес:
 ` curl 2ip.ru ` ;

![img_id_11](img_mediumcl/3.7.png)
* gw:
`ip r | grep def | grep -Eo '[0-9.]*' | head -n 1`;

![img_id_12](img_mediumcl/3.8.png)
* Названия сетевых интерфейсов:
` ifconfig ` ;

![img_id_13](img_mediumcl/3.9.png)

         

* 4. Ликбез по сетевым интерфейсам.


* **lo** - интерфейс обратной петли (loopback) позволяет компьютеру обращатся к самому себе. Интерфейс имеет ip-адрес 127.0.0.1 и может быть использован сетевым клиентским программным обеспечением, чтобы общаться с серверным приложением, расположенным на том же компьютере.
 * **DHCP (Dynamic Host Configuration Protocol)** — протокол прикладного уровня модели TCP/IP, служит для автоматизации назначения IP-адреса клиенту. Сервер всегда слушает 67 порт, ожидает широковещательное сообщение от клиента, а после его получения отправляет ответное предложение — DHCPOFFER. Клиент принимает сообщение на 68 порту.

*  Задаем статичные настройки **ip, gw, dns** в файле конфигурации netplan:

* Сперва вводим команду:

    

  ` nano /etc/netplan/00-installer-config.yaml `;
* Откроется nano:

![img_id_14](img_mediumcl/3.10.png)

* Туда вставляем следующий текст для изменения сетевых конфигураций на нужные нам:

![img_id_15](img_mediumcl/stats.png)

* Подтвержлаем конфигурации:

![img_id_16](img_mediumcl/apply.png)

* Перезагружаем машину:

![img_id_17](img_mediumcl/reb.png)

* Пингуем `1.1.1.1` и `ya.ru`:

![img_id_18](img_mediumcl/Ping1.png)
![img_id_19](img_mediumcl/pingya.png)


## Part 4. Обновление ОС.

* Начинаем процесс обновления командой `sudo apt-get update` для обновления информации о пакетах;

![img_id_20](img_mediumcl/4.1.png)
* Далее `sudo apt-get dist-upgrade` - обновление версии;

## Part 5. Использование команды sudo.

* Команда **sudo** ( substitute user and do, подменить пользователя и выполнить ) позволяет строго определенным пользователям выполнять указанные программы с административными привилегиями без ввода пароля суперпользователя root.

* Кажется пользователю **van**, который пришел к нам в **Part 2** стало грустно от его беспомощности, но мы можем это исрпавить с помощью команды: `sudo usermod -aG sudo van`;

![img_id_21](img_mediumcl/5.1.png)

* Вводим команду: `su - van`, чтобы перейти на учетную запись **van**;

* И вот, почувствовав вседозволенность, **van** решает сменить название хоста командой: `sudo -u van sudo hostnamectl set-hostname ne-user-1` ;

* Проверим командой `hostname`, получилось ли у него?

![img_id_22](img_mediumcl/5.2.png)

* Кажется да!

## Part 6. Установка и настройка службы времени.

* Вообще дату и время мы установили еще в **Part 2** , но давайте проверим правильность установленного времени с помощью команд:

`date;
 timedatectl show;`

![img_id_23](img_mediumcl/6.png)

* Успех!

## Part 7. Установка и использование текстовых редакторов.
* Основная цель задания - Установить текстовые редакторы VIM (+ любые два по желанию NANO, MCEDIT, JOE и т.д.)
Используя каждый из трех выбранных редакторов, создайте файл test_X.txt, где X -- название редактора, в котором создан файл. Напишите в нём свой никнейм, закройте файл с сохранением изменений.

* 1. NANO:
  * `nano test_nano.txt`;
  * Введите свй ник (**mediumcl**);

  ![img_id_24](img_mediumcl/7.1.png)
  * Нажмите **Cmd+O**, **Enter** для сохранения и **Cmd+X** для выхода;
  * `nano test_nano.txt`;
  * Нажимте **Cmd+\\**, введите строку, которую необходимо искать (**mediumcl**);

  ![img_id_25](img_mediumcl/7.2.png)
  *  и нажмите клавишу **Enter**. Затем введите строку, на которую произвести замену (**21 School 21**) и нажмите **Enter**; 

  ![img_id_26](img_mediumcl/7.3.png)
  * нажмите клавишу **A** для замены всех вхождений строки;

  ![img_id_27](img_mediumcl/7.4.png)
  * Нажмите **Cmd+X** для выхода;
  * Нажмите **N** для выхода без сохранения изменений;

  ![img_id_28](img_mediumcl/7.5.png)

* 2. Vim:
  * `vim test_vim.txt`;
  * Введите свй ник (**mediumcl**);

  ![img_id_29](img_mediumcl/7.6.png)
  * Для выхода с сохранением нажмите **ESC** , затем введите **:wq!**. Для подтверждения нажмите **Enter**;

  ![img_id_30](img_mediumcl/7.7.png)
  * `vim test_vim.txt`;
  * Меняем (**mediumcl**) на (**21 School 21**);
  Замена в **vim** -  **ESC** **:%s/"слово"/"замена слово"**;

  ![img_id_38](img_mediumcl/7.17.png)
  * Для выхода без сохранения нажимаем **ESC** , **SHIFT + вводим q!**. Для подтверждения нажмите **Enter**;

  ![img_id_31](img_mediumcl/7.8.png)

* 3. JOE:
  * Устанавливаем JOE `sudo apt install joe`;
  * `joe test_joe.txt`;
  * Введите свй ник (**mediumcl**);
  * Для выхода с сохранением нажмите **ctrl+K+X** , затем введите **y**. Для подтверждения нажмите **Enter**;

  ![img_id_32](img_mediumcl/7.10.png)
  * `joe test_joe.txt`
  * Меняем (**mediumcl**) на (**21 School 21**);
  Замена в **joe** -  **ctrl+G** - для поиска слова, подтверждааем на **Enter**, нажимаем **R** для замены,вводим нужное слово и подтверждааем на **Enter**, вводим **y**, чтобы подтвердить;

  ![img_id_32](img_mediumcl/7.11.png)
  ![img_id_33](img_mediumcl/7.12.png)
  ![img_id_34](img_mediumcl/7.13.png)
  ![img_id_35](img_mediumcl/7.14.png)
  ![img_id_36](img_mediumcl/7.15.png)
  * Для выхода без сохранения нажмите **ctrl+C** , затем введите **y**. Для подтверждения нажмите **Enter**;

  ![img_id_37](img_mediumcl/7.16.png)

## Part 8. Установка и базовая настройка сервиса SSHD.
* Устанавливаем и настраиваем SSH-сервер с помощью команд:

      `sudo apt-get update &&
      sudo apt-get install openssh-server net-tools && 
      sudo systemctl enable ssh &&  # добавляем сервер в автозапуск
      sudo sed -i '/Port/c\Port 2022' /etc/ssh/sshd_config &&  # изменяем порт
      sudo systemctl restart sshd;
      clear;
      ps -C sshd;
      netstat -tan;`

      
![img_id_39](img_mediumcl/8.1.png)
![img_id_40](img_mediumcl/8.2.png)
![img_id_41](img_mediumcl/8.3.png)
![img_id_42](img_mediumcl/8.4.png)
![img_id_43](img_mediumcl/8.png)

* Опции утилиты **ps**:
  * -A, -e - выбрать все процессы;
  * -a - выбрать все процессы, кроме фоновых;
  * -d - выбрать все процессы, даже фоновые, кроме процессов сессий;
  * -N - выбрать все процессы кроме указанных;
  * -С - выбирать процессы по имени команды;
  * -G - выбрать процессы по ID группы;
  * -p - выбрать процессы PID;
  * --ppid - выбрать процессы по PID родительского процесса;
  * -s - выбрать процессы по ID сессии;
  * -t - выбрать процессы по tty;
  * -u - выбрать процессы пользователя;
  * -x - найти все вхождения строки поиска.
  * Опции форматирования:
    * -с - отображать информацию планировщика;
    * -f - вывести максимум доступных данных, например, количество потоков;
    * -F - аналогично -f, только выводит ещё больше данных;
    * -l - длинный формат вывода;
    * -j - вывести процессы в стиле Jobs, минимум информации;
    * -M - добавить информацию о безопасности;
    * -o - позволяет определить свой формат вывода;
    * --sort - выполнять сортировку по указанной колонке;
    * -L - отображать потоки процессов в колонках LWP и NLWP;
    * -m - вывести потоки после процесса;
    * -V - вывести информацию о версии;
    * -H - отображать дерево процессов.

* Опции утилиты **netstat**:
  * -n - Отображение адресов и номеров портов в числовом формате.
  * -a - Отображение всех подключений и ожидающих портов.
  * -t - Отображение текущего подключения в состоянии переноса нагрузки с процессора на сетевой адаптер при передаче данных.

  ## Part 9. Установка и использование утилит top, htop.
* По выводу команды top определить и написать в отчёте:

* uptime:
     
![img_id_44](img_mediumcl/9.1.png)
  * количество авторизованных пользователей:
     
![img_id_45](img_mediumcl/9.2.png)
  * общую загрузку системы:
   
![img_id_46](img_mediumcl/9.3.png)
  * общее количество процессов:
     
![img_id_47](img_mediumcl/9.4.png)
  * загрузку cpu:
     
![img_id_48](img_mediumcl/9.8.png)
  * загрузку памяти:
     
![img_id_49](img_mediumcl/9.5.png)
  * pid процесса занимающего больше всего памяти:

![img_id_50](img_mediumcl/9.6.png)   
  * pid процесса, занимающего больше всего процессорного времени:

![img_id_51](img_mediumcl/9.7.png) 
В последних двух ситуациях **pid** совпадает.



* Вывод htop по отсортированным **PID**,**PERCENT_CPU**,**PERCENT_MEM**, **TIME** . 
* Сортируем с помощью команды ` htop -s " "`.

* PID:

![img_id_52](img_mediumcl/9.21.png) 
* PERCENT_CPU:

![img_id_53](img_mediumcl/9.22.png) 
* PERCENT_MEM:

![img_id_54](img_mediumcl/9.23.png) 
* TIME:

![img_id_55](img_mediumcl/9.24.png) 
* отфильтрованному для процесса sshd:
Нажмите **F4** - для того, чтобы на шаг стать ближе к завершению нужного действия, после запуска **htop**.

![img_id_56](img_mediumcl/9.25.png) 
* с процессом syslog, найденным, используя поиск:
Нажмите **F3** - для того, чтобы на шаг стать ближе к завершению нужного действия, после запуска **htop**.

![img_id_57](img_mediumcl/9.26.png) 
* с добавленным выводом hostname, clock и uptime:
Нажмите **F2** - для того, чтобы на шаг стать ближе к завершению нужного действия, после запуска **htop**.

![img_id_58](img_mediumcl/9.27.png) 


## Part 10. Использование утилиты fdisk.

* Запустить команду `sudo fdisk -l`.

**В отчёте написать название жесткого диска, его размер и количество секторов, а также размер swap.**

* Полное название жесткого диска: 
    * Общее название: **Disk /dev/sda**
    * Disk model: **VBOX**
    * Disk identifier: **3E7B479-B7EB-48E2-8AA9-77738756E7E9** ;

* Размер жесткого диска: **10GB**;
* количество секторов: **20971520 sectors**;
* размер swap **1.9 GB**

![img_id_59](img_mediumcl/10.png) 

* Размер swap так же можно узнать с помощью `free -h`

![img_id_60](img_mediumcl/10.1.png) 

## Part 11. Использование утилиты df.
*   **Запускаем команду df**;
Прописываем ` /` через пробел, для того, чтобы попасть в корневой раздел;
* размер раздела: **10215700 KB**;
* размер занятого пространства: **5112788 KB**;
* размер свободного пространства: **4562396 KB**;
* процент использования: **53%**;

 ![img_id_61](img_mediumcl/11.png) 

**Запустить команду df -Th.**;
Прописываем ` /` через пробел, для того, чтобы попасть в корневой раздел;

* размер раздела: **9,8 G**;
* размер занятого пространства: **4,9 G**;
* размер свободного пространства: **4,4 G**;
* процент использования: **53%**;
* тип файловой системы: **ext4**;

![img_id_62](img_mediumcl/11.1.png) 

## Part 12. Использование утилиты du.


* Нужно вывести размер папок /home, /var, /var/log (в байтах, в человекочитаемом виде) с помощью **du**;

* Для этого вводим команду `sudo du -hs -B KB /"путь к папке"`;

* /home:

![img_id_63](img_mediumcl/12.1.png)

* /var:

![img_id_64](img_mediumcl/12.2.png)

* /var/log:

![img_id_65](img_mediumcl/12.3.png)

* Вывести размер всего содержимого в /var/log (не общее, а каждого вложенного элемента, используя *):

![img_id_66](img_mediumcl/12.4.png)

## Part 13. Установка и использование утилиты ncdu.

* Установить утилиту ncdu. `sudo apt install ncdu`.
* Вывести размер папок /home, /var, /var/log.
* /home:

![img_id_67](img_mediumcl/13.1.png)

* /var:

![img_id_68](img_mediumcl/13.2.png)

* /var/log:

![img_id_69](img_mediumcl/13.3.png)

## Part 14. Работа с системными журналами.

* Написать в отчёте время последней успешной авторизации, имя пользователя и метод входа в систему.

* Устанавливаем **lnav** c помощью команды `sudo apt-get install lnav -y` .

* Проверяем последний вход командой `last -1`.

![img_id_70](img_mediumcl/14.1.png)

* С помощью команды **lnav** смотрим следующие логи:

* 1. /var/log/dmesg:

![img_id_71](img_mediumcl/14.2.png)

* 2. /var/log/syslog:

![img_id_72](img_mediumcl/13.3.png)
* 3. /var/log/auth.log:

![img_id_73](img_mediumcl/14.4.png)

Открыв **/var/log/auth.log** становится ясно, что последняя успешная авторизация - mediumcl в 17:33:01.

* Перезапустить службу SSHd.
`sudo systemctl restart ssh`;

* Скриншот после перезагрузки.

![img_id_74](img_mediumcl/14.5.png)

## Part 15. Использование планировщика заданий CRON.

* Используя планировщик заданий, запустите команду uptime через каждые 2 минуты.
* Вводим команду `crontab -e`
Затем задаем **uptime** каждые 2 минуты:

![img_id_75](img_mediumcl/15.1.png)
* Найти в системных журналах строчки (минимум две в заданном временном диапазоне) о выполнении:

![img_id_76](img_mediumcl/15.2.png)
* Для вывода списка текущих заданий **CRON** используем команду `crontab -l`:

![img_id_77](img_mediumcl/15.3.png)
* Удалите все задания из планировщика заданий командой `crontab -r` и проверим с помощью `crontab -l`:

![img_id_78](img_mediumcl/15.4.png)
